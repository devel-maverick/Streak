generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


enum SubscriptionPlan{
  FREE
  PRO
}

enum AuthProvider{
  LOCAL
  GOOGLE
}
enum Platform{
  LEETCODE
  CODEFORCES
  CODECHEF
  CSES
}
enum Difficulty{
  EASY
  MEDIUM
  HARD
}
enum Phase{
  BEFORE
  CODING
  ENDED
}

enum AIMessageRole {
  user
  ai
}

model User {
  id                 String    @id @default(uuid())
  name               String
  email              String    @unique
  password           String?    
  avatar             String?
  authProvider       AuthProvider @default(LOCAL)
  googleId           String?
  leetcodeUsername   String?
  subscriptionPlan   SubscriptionPlan @default(FREE)
  razorpayCustomerId       String?
  razorpaySubscriptionId   String?
  subscriptionEndDate      DateTime?

  codeforcesUsername String?
  codechefUsername   String?
  atcoderUsername    String?
  csesUsername       String?
  githubUrl          String?
  linkedinUrl        String?


  totalSolved         Int              @default(0)
  solvedLeetcode      Int              @default(0)
  solvedCodeforces    Int              @default(0)
  solvedCodechef      Int              @default(0)
  
  leetcodeEasy        Int              @default(0)
  leetcodeMedium      Int              @default(0)
  leetcodeHard        Int              @default(0)
  leetcodeRanking     Int?
  leetcodeRating      Int              @default(0)
  
  codeforcesRating    Int              @default(0)
  codeforcesMaxRating Int              @default(0)
  codeforcesRank      String?
  
  codechefRating      Int              @default(0)
  codechefStars       String?
  
  currentStreak       Int              @default(0)
  maxStreak           Int              @default(0)
  activeDays          Int              @default(0)
  lastSyncedAt        DateTime?
  
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt

  solvedProblems      SolvedProblem[]
  codeDrafts          CodeDraft[]
  aiMessages          AIMessage[]
  submissionActivity  SubmissionActivity[]
}

model SubmissionActivity {
  id          String   @id @default(uuid())
  userId      String
  platform    Platform
  date        DateTime
  count       Int      @default(1)
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, platform, date])
  @@index([userId, platform])
}

model Problem{
  id                 String    @id @default(uuid())
  title              String
  platform           Platform
  problemId          String
  url                String
  frequency          Float?
  acceptance         Float?
  difficulty         Difficulty?
  topics             String[]  @default([])
  company            String?
  description        String    @default("")
  rating             Int?

  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  samples            sampleIO[]
  solvedBy           SolvedProblem[]
  codeDrafts         CodeDraft[]
  aiMessages         AIMessage[]

  @@unique([platform, problemId, company])
  @@index([platform])
  @@index([difficulty])
  @@index([company])
}


model sampleIO{
  id                 String    @id @default(uuid())
  input              String
  output             String
  explanation        String?
  problemId          String
  problem            Problem  @relation(fields: [problemId], references: [id], onDelete: Cascade)
}

model SolvedProblem{
  id                 String    @id @default(uuid())
  userId             String
  problemId          String
  solvedAt           DateTime  @default(now())

  user               User      @relation(fields: [userId],references:[id],onDelete:Cascade)
  problem            Problem   @relation(fields:[problemId],references:[id],onDelete:Cascade)

  @@unique([userId, problemId])

}


model Contest{
  id                 String    @id @default(uuid())
  title              String
  platform           Platform
  contestId          String
  startTime          DateTime
  endTime            DateTime
  duration           Int
  phase              Phase
  url                String
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  @@unique([platform,contestId])
}



model CodeDraft{
  id                 String    @id @default(uuid())
  userId             String
  language           String
  problemId         String?
  code               String     @default("")
  input              String     @default("")
  output             String     @default("")
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  user               User      @relation(fields:[userId],references:[id],onDelete:Cascade)
  problem            Problem?  @relation(fields:[problemId],references:[id],onDelete:SetNull)

}


model AIMessage{
  id                 String    @id @default(uuid())
  userId             String
  problemId          String?
  message            String
  role               AIMessageRole
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  user               User      @relation(fields:[userId],references:[id],onDelete:Cascade)
  problem            Problem?  @relation(fields:[problemId],references:[id],onDelete:SetNull)
}


