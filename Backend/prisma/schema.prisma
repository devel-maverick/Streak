generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AuthProvider{
  LOCAL
  GOOGLE
}
enum Platform{
  LEETCODE
  CODEFORCES
  CODECHEF
  ATCODER
  CSES
}
enum Difficulty{
  EASY
  MEDIUM
  HARD
}
enum Phase{
  BEFORE
  CODING
  ENDED
}

enum AIMessageRole {
  user
  ai
}

model User {
  id                 String    @id @default(uuid())
  name               String
  email              String    @unique
  password           String?    
  avatar             String?
  authProvider       AuthProvider @default(LOCAL)
  googleId           String?
  leetcodeUsername   String?
  codeforcesUsername String?
  codechefUsername   String?
  atcoderUsername    String?
  csesUsername       String?
  totalSolved         Int              @default(0)
  solvedLeetcode      Int              @default(0)
  solvedCodeforces    Int              @default(0)
  solvedCodechef      Int              @default(0)
  solvedAtcoder       Int              @default(0)
  solvedCses          Int              @default(0)
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt

  solvedProblems      SolvedProblem[]
  codeDrafts          CodeDraft[]
  aiMessages          AIMessage[]
}

model Problem{
  id                 String    @id @default(uuid())
  title              String
  platform           Platform
  problemId          String
  url                String
  frequency          Float?
  acceptance         Float?
  difficulty         Difficulty?
  topics             String[]  @default([])
  companies          String[]  @default([])
  description        String    @default("")

  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  samples            sampleIO[]
  solvedBy           SolvedProblem[]
  codeDrafts         CodeDraft[]
  aiMessages          AIMessage[]

  @@unique([platform, problemId])
  @@index([platform])
  @@index([difficulty])
}


model sampleIO{
  id                 String    @id @default(uuid())
  input              String
  output             String
  explanation        String?
  problemId          String
  problem            Problem  @relation(fields: [problemId], references: [id], onDelete: Cascade)
}

model SolvedProblem{
  id                 String    @id @default(uuid())
  userId             String
  problemId          String
  solvedAt           DateTime  @default(now())

  user               User      @relation(fields: [userId],references:[id],onDelete:Cascade)
  problem            Problem   @relation(fields:[problemId],references:[id],onDelete:Cascade)

  @@unique([userId, problemId])

}


model Contest{
  id                 String    @id @default(uuid())
  title              String
  platform           Platform
  contestId          String
  startTime          DateTime
  endTime            DateTime
  duration           Int
  phase              Phase
  url                String
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  @@unique([platform,contestId])
}



model CodeDraft{
  id                 String    @id @default(uuid())
  userId             String
  language           String
  problemId         String?
  code               String     @default("")
  input              String     @default("")
  output             String     @default("")
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  user               User      @relation(fields:[userId],references:[id],onDelete:Cascade)
  problem            Problem?  @relation(fields:[problemId],references:[id],onDelete:SetNull)

}


model AIMessage{
  id                 String    @id @default(uuid())
  userId             String
  problemId          String?
  message            String
  role               AIMessageRole
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  user               User      @relation(fields:[userId],references:[id],onDelete:Cascade)
  problem            Problem?  @relation(fields:[problemId],references:[id],onDelete:SetNull)
}


